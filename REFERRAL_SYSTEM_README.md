# 🎯 سیستم دعوت و گیم فیکیشن SarlakBot

## 🌟 ویژگی‌های جدید

### 1. سیستم دعوت دوستان
- **کد دعوت منحصر به فرد**: هر کاربر کد دعوت مخصوص خود را دارد
- **لینک دعوت خودکار**: لینک دعوت با کد منحصر به فرد تولید می‌شود
- **پاداش‌های چندسطحی**: پاداش‌های مختلف بر اساس تعداد دعوت‌ها
- **آمار کامل**: نمایش آمار دعوت‌ها و پاداش‌ها

### 2. سیستم توکن و قرعه‌کشی
- **توکن‌های مجازی**: سیستم توکن برای پاداش‌دهی
- **قرعه‌کشی‌های هفتگی**: قرعه‌کشی با جوایز واقعی
- **مدیریت موجودی**: پیگیری توکن‌های کسب شده و خرج شده
- **تراکنش‌ها**: تاریخچه کامل تراکنش‌ها

### 3. سیستم گیم فیکیشن
- **مأموریت‌های روزانه**: چالش‌های روزانه برای کسب امتیاز
- **سیستم streak**: پیگیری فعالیت‌های متوالی
- **جدول رتبه‌بندی**: رقابت با سایر کاربران
- **دستاوردها و نشان‌ها**: سیستم پاداش پیشرفته

## 🗄️ جداول پایگاه داده

### جداول جدید:
1. **referral_codes**: کدهای دعوت کاربران
2. **user_referrals**: دعوت‌های انجام شده
3. **user_tokens**: موجودی توکن‌های کاربران
4. **token_transactions**: تراکنش‌های توکن
5. **lotteries**: قرعه‌کشی‌ها
6. **lottery_entries**: ورودی‌های قرعه‌کشی
7. **daily_quests**: مأموریت‌های روزانه
8. **user_quests**: مأموریت‌های کاربران
9. **user_streaks**: streakهای کاربران

## 🚀 نحوه استفاده

### برای کاربران:
1. `/referral` - دسترسی به سیستم دعوت
2. `/invite` - دسترسی سریع به سیستم دعوت
3. `/دعوت` - دسترسی فارسی به سیستم دعوت

### برای توسعه‌دهندگان:
```python
from src.services.referral_service import referral_service
from src.services.token_service import token_service
from src.services.gamification_service import gamification_service

# ایجاد کد دعوت
referral_code = await referral_service.create_referral_code(user_id)

# پردازش دعوت
success = await referral_service.process_referral(referrer_id, referred_id, referral_code)

# اضافه کردن توکن
await token_service.add_tokens(user_id, 100, "referral", "دعوت دوست")

# به‌روزرسانی مأموریت
await gamification_service.update_quest_progress(user_id, "referral", 1)
```

## 🎮 سیستم امتیازدهی

### امتیازات دعوت:
- **اولین دعوت**: 100 امتیاز + 10 توکن
- **5 دعوت**: 500 امتیاز + 50 توکن
- **10 دعوت**: 1200 امتیاز + 120 توکن
- **25 دعوت**: 3500 امتیاز + 350 توکن
- **50 دعوت**: 8000 امتیاز + 800 توکن
- **100 دعوت**: 20000 امتیاز + 2000 توکن

### مأموریت‌های روزانه:
- **مطالعه روزانه**: 30 دقیقه مطالعه = 50 امتیاز + 5 توکن
- **دعوت دوست**: 1 دعوت = 100 امتیاز + 10 توکن
- **ورود روزانه**: 1 ورود = 20 امتیاز + 2 توکن
- **تکمیل پروفایل**: 1 تکمیل = 30 امتیاز + 3 توکن
- **شرکت در رقابت**: 1 شرکت = 75 امتیاز + 8 توکن

## 🔧 تنظیمات

### متغیرهای محیطی:
```bash
# تنظیمات پایگاه داده
DB_HOST=localhost
DB_PORT=5432
DB_NAME=botsarlak
DB_USER=postgres
DB_PASS=ali123123

# تنظیمات ربات
BOT_TOKEN=your_bot_token
```

### تنظیمات پیش‌فرض:
- **هزینه هر ورودی قرعه‌کشی**: 50 توکن
- **حداکثر ورودی هر کاربر**: 1 ورودی
- **مدت زمان قرعه‌کشی**: 7 روز
- **جایزه قرعه‌کشی**: 100 دلار

## 📊 آمار و گزارش‌گیری

### آمار قابل دسترسی:
- تعداد دعوت‌های هر کاربر
- امتیازات کسب شده
- توکن‌های موجود
- مأموریت‌های تکمیل شده
- streakهای فعال
- رتبه در جدول رتبه‌بندی

### گزارش‌های مدیریتی:
- آمار کلی سیستم
- کاربران فعال
- دعوت‌های موفق
- تراکنش‌های توکن
- قرعه‌کشی‌های انجام شده

## 🛡️ امنیت

### ویژگی‌های امنیتی:
- **اعتبارسنجی کد دعوت**: بررسی صحت کدهای دعوت
- **محدودیت دعوت خودی**: جلوگیری از دعوت خود
- **مدیریت تراکنش‌ها**: ثبت کامل تراکنش‌ها
- **بررسی موجودی**: بررسی کافی بودن توکن‌ها
- **محدودیت ورودی**: محدودیت ورودی در قرعه‌کشی

## 🔄 به‌روزرسانی‌ها

### نسخه 3.1.0:
- ✅ سیستم دعوت دوستان
- ✅ سیستم توکن و قرعه‌کشی
- ✅ سیستم گیم فیکیشن
- ✅ مأموریت‌های روزانه
- ✅ جدول رتبه‌بندی
- ✅ سیستم streak

### برنامه‌های آینده:
- 🔄 سیستم چالش‌های هفتگی
- 🔄 سیستم تیم‌ها و گروه‌ها
- 🔄 سیستم خرید و فروش توکن
- 🔄 سیستم رویدادهای ویژه
- 🔄 سیستم پاداش‌های فصلی

## 📞 پشتیبانی

برای سوالات و مشکلات:
- **تیم توسعه**: @sarlak_dev
- **پشتیبانی فنی**: @sarlak_support
- **گزارش باگ**: @sarlak_bugs

---

**SarlakBot v3.1.0** - سیستم دعوت و گیم فیکیشن حرفه‌ای 🚀
